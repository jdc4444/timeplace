:root {
  --bg-top: #f2f4f7;
  --bg-mid: #d4d8de;
  --bg-bot: #a8aeb8;
  --ink-muted: rgba(37, 49, 63, 0.72);
}

* {
  box-sizing: border-box;
}

html,
body {
  width: 100%;
  min-height: 100%;
  margin: 0;
}

body {
  overflow: hidden;
  font-family: "Avenir Next", Avenir, "Segoe UI", sans-serif;
  background:
    radial-gradient(88rem 54rem at 18% -8%, rgba(255, 255, 255, 0.42), transparent 64%),
    radial-gradient(72rem 52rem at 82% 10%, rgba(226, 234, 247, 0.26), transparent 68%),
    linear-gradient(180deg, var(--bg-top) 0%, var(--bg-mid) 58%, var(--bg-bot) 100%);
}

.viewport {
  position: fixed;
  inset: 0;
}

.viewport::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(100% 72% at 50% 14%, rgba(255, 255, 255, 0.4), transparent 70%);
}

.site-title {
  position: absolute;
  top: clamp(20px, 4vh, 50px);
  left: clamp(20px, 3vw, 40px);
  z-index: 6;
  margin: 0;
  font-size: 0.82rem;
  font-weight: 800;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: rgba(0, 0, 0, 0.7);
  pointer-events: none;
}

/* ── Search Bar ── */

.search-container {
  position: absolute;
  top: calc(clamp(20px, 4vh, 50px) + 1.4rem);
  left: clamp(20px, 3vw, 40px);
  z-index: 7;
  width: 260px;
}

.search-input {
  width: 100%;
  padding: 0.42rem 1.6rem 0.42rem 0;
  border: none;
  background: transparent;
  font: 500 0.76rem/1.2 "Avenir Next", Avenir, "Segoe UI", sans-serif;
  color: rgba(24, 36, 52, 0.88);
  outline: none;
  caret-color: rgba(24, 36, 52, 0.88);
}

.search-placeholder {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  font: 500 0.76rem/1.2 "Avenir Next", Avenir, "Segoe UI", sans-serif;
  color: rgba(0, 0, 0, 0.32);
  pointer-events: none;
  transition: opacity 300ms ease;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: calc(100% - 1.6rem);
}

.search-placeholder.is-hidden {
  opacity: 0;
}

.search-placeholder.is-fading {
  opacity: 0;
  transition: opacity 200ms ease;
}

.search-cursor {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font: 500 0.76rem/1.2 "Avenir Next", Avenir, "Segoe UI", sans-serif;
  color: rgba(24, 36, 52, 0.6);
  pointer-events: none;
  animation: blink 1s step-end infinite;
}

.search-cursor.is-hidden {
  display: none;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

.search-clear {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  border: none;
  background: none;
  font-size: 1.1rem;
  color: rgba(0, 0, 0, 0.35);
  cursor: pointer;
  padding: 0 0.2rem;
  line-height: 1;
}

.search-clear:hover {
  color: rgba(0, 0, 0, 0.65);
}

/* Search results header */
.fi-search-header {
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(35, 48, 64, 0.4);
  text-align: center;
  margin: 0.6rem 0 0.8rem;
}

/* Hide search bar during loading */
.viewport.is-loading .search-container {
  opacity: 0;
  pointer-events: none;
}

.search-container {
  transition: opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1) 0.3s;
}

.stage {
  position: absolute;
  inset: 0;
  z-index: 1;
}

/* ── Preset Dock (sits above bottom bar) ── */

.preset-dock {
  position: absolute;
  left: 50%;
  bottom: calc(clamp(14px, 3vh, 30px) + 72px);
  transform: translateX(-50%);
  z-index: 5;
  display: flex;
  gap: 0.42rem;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  max-width: min(94vw, 1100px);
  padding: 0.46rem 0.54rem;
  border-radius: 999px;
  border: 1px solid rgba(58, 70, 88, 0.24);
  background: rgba(244, 247, 252, 0.7);
  backdrop-filter: blur(9px) saturate(1.06);
  box-shadow: 0 10px 24px -20px rgba(16, 25, 37, 0.8);
}

.lighting-preset-button {
  border: 1px solid rgba(53, 67, 87, 0.26);
  background: rgba(255, 255, 255, 0.84);
  color: rgba(28, 40, 56, 0.9);
  font: 700 0.73rem/1.05 "Avenir Next", Avenir, "Segoe UI", sans-serif;
  letter-spacing: 0.012em;
  border-radius: 999px;
  padding: 0.34rem 0.6rem;
  cursor: pointer;
  transition: background-color 140ms ease, border-color 140ms ease, color 140ms ease;
}

.lighting-preset-button:hover {
  background: rgba(255, 255, 255, 0.95);
}

.lighting-preset-button.is-active {
  background: rgba(149, 105, 42, 0.94);
  border-color: rgba(128, 85, 29, 0.96);
  color: #f8f3ea;
}

.lighting-readout {
  margin: 0.22rem 0 0;
  padding: 0.44rem 0.5rem;
  border-radius: 0.52rem;
  border: 1px solid rgba(59, 72, 90, 0.18);
  background: rgba(255, 255, 255, 0.46);
  font: 500 0.68rem/1.36 "SF Mono", Menlo, Consolas, monospace;
  color: rgba(31, 44, 60, 0.84);
  white-space: pre-wrap;
}

.globe-canvas {
  width: 100%;
  height: 100%;
  display: block;
  touch-action: none;
}

/* ── Spinner ── */

.loader-spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 48px;
  height: 48px;
  border: 1.5px solid rgba(0, 0, 0, 0.1);
  border-top-color: rgba(0, 0, 0, 0.5);
  border-radius: 50%;
  z-index: 110;
  animation: spin 1.2s linear infinite;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

.viewport.is-loading .loader-spinner {
  opacity: 1;
}

@keyframes spin {
  to { transform: translate(-50%, -50%) rotate(360deg); }
}

/* ── Hide UI during loading ── */

.viewport.is-loading .status,
.viewport.is-loading .bottom-bar {
  opacity: 0;
}

.bottom-bar {
  transition: opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1) 0.3s;
}

.status {
  position: absolute;
  left: 50%;
  bottom: calc(clamp(14px, 3vh, 30px) + 110px);
  transform: translateX(-50%);
  margin: 0;
  padding: 0.28rem 0.62rem;
  font-size: 0.78rem;
  letter-spacing: 0.012em;
  color: var(--ink-muted);
  background: rgba(255, 255, 255, 0.42);
  border-radius: 999px;
  backdrop-filter: blur(7px);
}

.status[data-state="ok"] {
  opacity: 0;
  transition: opacity 0.55s ease;
}

.status[data-state="warn"] {
  color: rgba(92, 38, 17, 0.86);
}

/* ── Bottom Bar ── */

.bottom-bar {
  position: absolute;
  bottom: clamp(14px, 3vh, 30px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  width: min(94vw, 620px);
}

.bottom-bar-slider-row {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  width: 100%;
}

.bottom-bar-center {
  flex: 1;
  min-width: 0;
  position: relative;
  height: 22px;
  cursor: pointer;
  touch-action: none;
}

/* ── Custom Dual-Thumb Slider ── */

.slider-track {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 3px;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.18);
  border-radius: 2px;
  pointer-events: none;
}

.slider-fill {
  position: absolute;
  top: 50%;
  height: 3px;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.55);
  border-radius: 2px;
  pointer-events: none;
}

.slider-thumb {
  position: absolute;
  top: 50%;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #000;
  transform: translate(-50%, -50%);
  cursor: pointer;
  z-index: 2;
  touch-action: none;
}

.slider-thumb:hover {
  transform: translate(-50%, -50%) scale(1.25);
}

.slider-thumb.is-hidden {
  display: none;
}

.dock-btn {
  border: none;
  background: rgba(255, 255, 255, 0.45);
  color: rgba(28, 40, 56, 0.7);
  font: 600 0.78rem/1.1 "Avenir Next", Avenir, "Segoe UI", sans-serif;
  letter-spacing: 0.02em;
  border-radius: 999px;
  padding: 0.48rem 1rem;
  cursor: pointer;
  transition: background-color 180ms ease, color 180ms ease, box-shadow 180ms ease;
  white-space: nowrap;
  flex-shrink: 0;
  backdrop-filter: blur(6px);
}

.dock-btn:hover {
  background: rgba(255, 255, 255, 0.7);
  color: rgba(28, 40, 56, 0.88);
}

.dock-btn.is-active {
  background: rgba(36, 48, 66, 0.82);
  color: rgba(245, 248, 252, 0.95);
  box-shadow: 0 2px 10px -3px rgba(16, 25, 37, 0.35);
}

/* ── Date Display ── */

.date-display {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 0.4rem;
  pointer-events: none;
  user-select: none;
}

.date-day-name {
  font-size: 0.82rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: #000;
  line-height: 1;
}

.date-full {
  font-size: 0.82rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: #000;
  line-height: 1;
}

/* ── Sleek desaturated slider ── */

/* (native .day-slider removed — replaced by custom dual-thumb slider above) */

/* ── Category Filters (horizontal row above list) ── */

.super-filters {
  position: absolute;
  top: clamp(20px, 4vh, 50px);
  right: clamp(20px, 3vw, 40px);
  z-index: 7;
  display: flex;
  justify-content: space-between;
  width: 340px;
  pointer-events: auto;
}

.cat-toggle {
  border: 1px solid rgba(0, 0, 0, 0.15);
  background: transparent;
  color: rgba(0, 0, 0, 0.38);
  font: 700 0.6rem/1 "Avenir Next", Avenir, "Segoe UI", sans-serif;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding: 0.3rem 0.6rem;
  border-radius: 999px;
  cursor: pointer;
  transition: color 150ms ease, background 150ms ease, border-color 150ms ease;
  white-space: nowrap;
}

.cat-toggle:hover {
  color: rgba(0, 0, 0, 0.6);
  border-color: rgba(0, 0, 0, 0.3);
}

.cat-toggle.is-on {
  color: rgba(0, 0, 0, 0.85);
  background: rgba(0, 0, 0, 0.06);
  border-color: rgba(0, 0, 0, 0.4);
}

/* ── Festival Info (top right, no panel) ── */

.festival-info {
  position: absolute;
  top: calc(clamp(20px, 4vh, 50px) + 3rem);
  right: clamp(20px, 3vw, 40px);
  z-index: 6;
  max-width: 340px;
  max-height: calc(100vh - 120px - 3rem);
  overflow-y: auto;
  pointer-events: none;
  scrollbar-width: none;
}

.festival-info::-webkit-scrollbar {
  display: none;
}

.fi-top-list,
.festival-info > .fi-name,
.festival-info > .fi-location,
.festival-info > .fi-date,
.festival-info > .fi-tags,
.festival-info > .fi-desc,
.festival-info > .fi-details,
.festival-info > .fi-stats {
  pointer-events: auto;
}

.fi-top-entry {
  margin-bottom: 1.6rem;
}

.fi-top-entry:last-child {
  margin-bottom: 0;
}

.fi-name {
  margin: 0 0 0.25rem;
  font-size: 1.18rem;
  font-weight: 800;
  letter-spacing: -0.025em;
  color: rgba(24, 36, 52, 0.9);
  line-height: 1.12;
}

.fi-location {
  font-size: 0.88rem;
  font-weight: 600;
  color: rgba(35, 48, 64, 0.62);
  letter-spacing: 0.005em;
}

.fi-date {
  font-size: 0.82rem;
  font-weight: 500;
  color: rgba(35, 48, 64, 0.5);
  margin-top: 0.1rem;
}

.fi-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.28rem;
  margin-top: 0.5rem;
}

.fi-tag {
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  padding: 0.12rem 0.48rem;
  border-radius: 999px;
  background: rgba(36, 48, 64, 0.08);
  color: rgba(35, 48, 64, 0.58);
}

.fi-desc {
  margin: 0.45rem 0 0;
  font-size: 0.82rem;
  font-weight: 500;
  line-height: 1.42;
  color: rgba(28, 40, 56, 0.72);
}

.fi-details {
  margin: 0.3rem 0 0;
  font-size: 0.74rem;
  font-weight: 400;
  line-height: 1.48;
  color: rgba(35, 48, 64, 0.52);
}

.fi-stats {
  display: flex;
  flex-wrap: wrap;
  gap: 0.6rem;
  margin-top: 0.4rem;
}

.fi-stat {
  font-size: 0.72rem;
  font-weight: 500;
  color: rgba(35, 48, 64, 0.45);
  font-variant-numeric: tabular-nums;
}

@media (max-width: 640px) {
  .preset-dock {
    max-width: calc(100vw - 14px);
    padding: 0.4rem 0.46rem;
    gap: 0.34rem;
  }

  .lighting-preset-button {
    font-size: 0.68rem;
    padding: 0.28rem 0.5rem;
  }

  /* Bottom bar: raised, with safe-area padding for iPhone home indicator */
  .bottom-bar {
    width: calc(100vw - 20px);
    gap: 0.5rem;
    bottom: calc(16px + env(safe-area-inset-bottom, 0px));
  }

  .dock-btn {
    font-size: 0.7rem;
    padding: 0.4rem 0.7rem;
  }

  .date-day-name,
  .date-full {
    font-size: 0.76rem;
  }

  /* Title: centered on mobile, slightly larger */
  .site-title {
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.78rem;
  }

  /* Search bar: subtle underline, balanced type size */
  .search-container {
    top: calc(clamp(20px, 4vh, 50px) + 1.6rem);
    left: 16px;
    right: 16px;
    transform: none;
    width: auto;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .search-input {
    font-size: 0.86rem;
    padding: 0.5rem 1.6rem 0.5rem 0;
  }

  .search-placeholder {
    font-size: 0.86rem;
  }

  .search-cursor {
    font-size: 0.86rem;
  }

  /* Filters: more space below search, full-width buttons */
  .super-filters {
    top: calc(clamp(20px, 4vh, 50px) + 4.8rem);
    left: 16px;
    right: 16px;
    transform: none;
    width: auto;
    gap: 0.4rem;
    justify-content: center;
  }

  .cat-toggle {
    flex: 1;
    font-size: 0.66rem;
    padding: 0.36rem 0;
    text-align: center;
  }

  /* Festival list */
  .festival-info {
    top: calc(clamp(20px, 4vh, 50px) + 7.15rem);
    left: 16px;
    right: 16px;
    max-width: none;
    max-height: calc(100vh - clamp(20px, 4vh, 50px) - 7.15rem - 90px - env(safe-area-inset-bottom, 0px));
    pointer-events: auto;
    -webkit-overflow-scrolling: touch;
  }

  .fi-name {
    font-size: 1rem;
    margin-bottom: 0.12rem;
    color: rgba(20, 30, 46, 0.95);
  }

  .fi-location {
    font-size: 0.78rem;
    color: rgba(30, 42, 58, 0.72);
  }

  .fi-date {
    font-size: 0.74rem;
    color: rgba(30, 42, 58, 0.6);
  }

  .fi-tags {
    margin-top: 0.3rem;
  }

  .fi-tag {
    font-size: 0.54rem;
    padding: 0.1rem 0.38rem;
    background: rgba(36, 48, 64, 0.1);
    color: rgba(30, 42, 58, 0.7);
  }

  .fi-desc {
    font-size: 0.86rem;
    margin-top: 0.3rem;
    line-height: 1.42;
    color: rgba(24, 36, 52, 0.82);
  }

  .fi-details {
    font-size: 0.8rem;
    line-height: 1.44;
    color: rgba(30, 42, 58, 0.62);
  }

  .fi-stats {
    gap: 0.4rem;
    margin-top: 0.3rem;
  }

  .fi-stat {
    font-size: 0.66rem;
  }

  .fi-top-entry {
    margin-bottom: 1rem;
  }

  .loader-spinner {
    width: 36px;
    height: 36px;
  }
}
